# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
From the following tables write a SQL query to find all orders generated by New York-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

Answer:

SELECT Orders.ord_no, Orders.purch_amt, Orders.ord_date, Orders.customer_id, Orders.salesman_id FROM Orders JOIN Salesman ON Orders.salesman_id = Salesman.salesman_id WHERE Salesman.city = 'New York';

**Output:**

![image](https://github.com/user-attachments/assets/2d6f7566-e64a-4966-bb2d-560eae4f578c)


**Question 2**
---

Question 2: Write a SQL query to Find employees who have an age less than the average age of employees with incomes over 1 million Employee Table

![image](https://github.com/user-attachments/assets/b558780c-a163-4ca6-a972-b0099904ffb8)


Answer:

SELECT id,name, age, city, income FROM Employee WHERE age < (SELECT AVG(age) FROM Employee
WHERE income > 1000000);

**Output:**

![image](https://github.com/user-attachments/assets/525e83dc-7a46-4f58-b540-495bf5096774)


**Question 3**
---
From the following tables write a SQL query to find the order values greater than the average order value of 10th October 2012. Return ord_no, purch_amt, ord_date, customer_id, salesman_id. Note: date should be yyyy-mm-dd format ORDERS TABLE

![image](https://github.com/user-attachments/assets/588f7b7d-4335-457f-b1e0-05a5e975710e)


Answer:

SELECT ord_no, purch_amt, ord_date, customer_id, salesman_id FROM Orders WHERE purch_amt > (SELECT AVG(purch_amt) FROM Orders WHERE ord_date = '2012-10-10');

**Output:**

![image](https://github.com/user-attachments/assets/39b29669-5edb-4030-86c1-5b343a8be09d)


**Question 4**
---
Write a SQL query to Find employees who have an age less than the average age of employees with incomes over 2.5 Lakh Employee Table

![image](https://github.com/user-attachments/assets/bcdbd879-1028-4b57-98fa-94f79e3bf7c9)


Answer:

SELECT id,name, age, city, income FROM Employee WHERE age < (SELECT AVG(age)
FROM Employee
WHERE income > 250000);

**Output:**

![image](https://github.com/user-attachments/assets/7d7f5c80-5a8c-4f45-b978-fb92b16b5edf)


**Question 5**
---
Write a SQL query to Identify customers whose city is different from the city of the customer with the highest ID SAMPLE TABLE: customer

![image](https://github.com/user-attachments/assets/bea66cb0-5555-480e-8322-c6e68b2668e6)


Answer:

SELECT id, name, city, email, phone FROM customer WHERE city != (SELECT city
FROM customer
ORDER BY id DESC
LIMIT 1);

**Output:**

![image](https://github.com/user-attachments/assets/13d0871b-4a08-44ea-b5ad-bd9ef7aad2d2)


**Question 6**
---
From the following tables write a SQL query to count the number of customers with grades above the average in New York City. Return grade and count. customer table

![image](https://github.com/user-attachments/assets/17937695-add0-4c66-8d2b-eaa0af0a22e8)


Answer:

SELECT grade, COUNT(*) FROM customer WHERE grade > (SELECT AVG(grade) FROM customer WHERE city = 'New York') GROUP BY grade;

**Output:**

![image](https://github.com/user-attachments/assets/7e4bd23a-7290-4372-91e0-35802c6b5496)


**Question 7**
---
Write a query to display all the customers whose ID is the difference between the salesperson ID of Mc Lyon and 2001.

salesman table image

![image](https://github.com/user-attachments/assets/c16bdcd8-034b-4ff8-91ac-a5838f36fc77)

customer table image

![image](https://github.com/user-attachments/assets/ab2dbb1d-8ca5-4cfa-ab2a-2e6bf2463821)

Answer:

SELECT customer_id, cust_name, city, grade, salesman_id FROM customer WHERE customer_id = ( SELECT salesman_id - 2001 FROM salesman WHERE name = 'Mc Lyon' );
**Output:**

![image](https://github.com/user-attachments/assets/5c99d906-d7db-4a28-9050-05343e38de02)


**Question 8**
---
 From the following tables, write a SQL query to find all the orders issued by the salesman 'Paul Adam'. Return ord_no, purch_amt, ord_date, customer_id and salesman_id.

Answer:

SELECT ord_no, purch_amt, ord_date, customer_id, salesman_id FROM Orders WHERE salesman_id = ( SELECT salesman_id
FROM Salesman
WHERE name = 'Paul Adam' );

**Output:**

![image](https://github.com/user-attachments/assets/38274dbe-fc8e-4c60-b450-667397dade41)


**Question 9**
---
Write a SQL query that retrieve all the columns from the table "Grades", where the grade is equal to the maximum grade achieved in each subject. Sample table: GRADES

Answer: WITH MaxGrades AS ( SELECT subject, MAX(grade) AS max_grade FROM Grades GROUP BY subject )

SELECT g.* FROM Grades g JOIN MaxGrades mg ON g.subject = mg.subject AND g.grade = mg.max_grade;

**Output:**

![image](https://github.com/user-attachments/assets/4b4c32e2-f5af-4704-8727-aa4008718d61)

**Question 10**
---
 Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is greater than $4500. Sample table: CUSTOMERS

![image](https://github.com/user-attachments/assets/4a242999-1992-4a38-97d1-a09f22e77254)


Answer: SELECT * FROM CUSTOMERS WHERE SALARY > 4500;

**Output:**

![image](https://github.com/user-attachments/assets/4087dca9-3bb8-4b06-8a18-406f7238d190)

## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
